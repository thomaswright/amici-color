// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Ulid from "ulid";
import * as React from "react";
import * as Common from "./Common.res.mjs";
import * as XStack from "./XStack.res.mjs";
import * as YStack from "./YStack.res.mjs";
import * as ViewGamut from "./ViewGamut.res.mjs";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";
import * as Core__Array from "@rescript/core/src/Core__Array.res.mjs";
import * as Color from "@texel/color";
import * as Core__Option from "@rescript/core/src/Core__Option.res.mjs";
import DropdownJsx from "./Dropdown.jsx";
import * as JsxRuntime from "react/jsx-runtime";
import AmiciPrismSvgreact from "./assets/amici-prism.svg?react";

var make = AmiciPrismSvgreact;

var make$1 = DropdownJsx;

function makeDefaultPicks(xLen, defaultShades) {
  var yLenF = defaultShades.length;
  return Common.Utils.mapRange(xLen, (function (x) {
                var hue = x / xLen * 360 + 1;
                var hueId = Ulid.ulid();
                var elements = defaultShades.map(function (shade, y) {
                      var s = (y + 1) / yLenF;
                      var match = Color.convert([
                            hue,
                            s,
                            1.0
                          ], Color.OKHSV, Color.OKHSL);
                      return {
                              id: Ulid.ulid(),
                              shadeId: shade.id,
                              hueId: hueId,
                              lightness: match[2],
                              saturation: match[1]
                            };
                    });
                return {
                        id: hueId,
                        value: hue,
                        name: Common.hueToName(hue),
                        elements: elements
                      };
              }));
}

function viewName(view) {
  switch (view) {
    case "View_LC" :
        return "oklch";
    case "View_SV" :
        return "okhsv";
    case "View_SL" :
        return "okhsl";
    
  }
}

var defaultShades = Common.Utils.mapRange(5, (function (i) {
        return {
                id: Ulid.ulid(),
                name: Math.imul(i + 1 | 0, 100).toString()
              };
      }));

var defaultPicks = makeDefaultPicks(5, defaultShades);

function App$Palette(props) {
  var match = React.useState(function () {
        return "View_SV";
      });
  var setView = match[1];
  var view = match[0];
  var match$1 = React.useState(function () {
        return defaultPicks;
      });
  var setPicks = match$1[1];
  var match$2 = React.useState(function () {
        return defaultShades;
      });
  var setShades = match$2[1];
  var shades = match$2[0];
  var match$3 = React.useState(function () {
        
      });
  var setSelectedHue = match$3[1];
  var selectedHue = match$3[0];
  var match$4 = React.useState(function () {
        
      });
  var setSelectedElement = match$4[1];
  var selectedElement = match$4[0];
  var handleKeydown = React.useCallback((function ($$event) {
          var updateElement = function (f) {
            Core__Option.mapOr(selectedElement, undefined, (function (e) {
                    setPicks(function (p_) {
                          return p_.map(function (hue) {
                                      return {
                                              id: hue.id,
                                              value: hue.value,
                                              name: hue.name,
                                              elements: hue.elements.map(function (hueElement) {
                                                      if (hueElement.id === e) {
                                                        return f(hueElement, hue.value);
                                                      } else {
                                                        return hueElement;
                                                      }
                                                    }).toSorted(function (a, b) {
                                                    return b.lightness - a.lightness;
                                                  })
                                            };
                                    });
                        });
                  }));
          };
          var updateHue = function (f) {
            Core__Option.mapOr(selectedHue, undefined, (function (selectedHue_) {
                    setPicks(function (p_) {
                          return p_.map(function (hue) {
                                      if (hue.id === selectedHue_) {
                                        return {
                                                id: hue.id,
                                                value: Common.Utils.bound(f(hue.value), 0, 360),
                                                name: hue.name,
                                                elements: hue.elements
                                              };
                                      } else {
                                        return hue;
                                      }
                                    });
                        });
                  }));
          };
          var match = $$event.key;
          switch (match) {
            case "ArrowDown" :
                updateElement(function (el, param) {
                      return {
                              id: el.id,
                              shadeId: el.shadeId,
                              hueId: el.hueId,
                              lightness: el.lightness,
                              saturation: Math.max(0.0, el.saturation - 0.01)
                            };
                    });
                $$event.preventDefault();
                return ;
            case "ArrowLeft" :
                switch (view) {
                  case "View_LC" :
                      updateElement(function (el, hue) {
                            var match = Color.convert([
                                  hue,
                                  el.saturation,
                                  el.lightness
                                ], Color.OKHSL, Color.OKLCH);
                            var newL = Math.max(0.0, match[0] - 0.01);
                            var match$1 = Color.convert([
                                  newL,
                                  match[1],
                                  match[2]
                                ], Color.OKLCH, Color.OKHSL);
                            var outputL = match$1[2];
                            var outputS = match$1[1];
                            var rgb = Color.convert([
                                  hue,
                                  outputS,
                                  outputL
                                ], Color.OKHSL, Color.sRGB);
                            if (Color.isRGBInGamut(rgb)) {
                              return {
                                      id: el.id,
                                      shadeId: el.shadeId,
                                      hueId: el.hueId,
                                      lightness: outputL,
                                      saturation: outputS
                                    };
                            } else {
                              return el;
                            }
                          });
                      break;
                  case "View_SV" :
                      updateElement(function (el, hue) {
                            var match = Color.convert([
                                  hue,
                                  el.saturation,
                                  el.lightness
                                ], Color.OKHSL, Color.OKHSV);
                            var newV = Math.max(0.0, match[2] - 0.01);
                            var match$1 = Color.convert([
                                  hue,
                                  match[1],
                                  newV
                                ], Color.OKHSV, Color.OKHSL);
                            return {
                                    id: el.id,
                                    shadeId: el.shadeId,
                                    hueId: el.hueId,
                                    lightness: match$1[2],
                                    saturation: match$1[1]
                                  };
                          });
                      break;
                  case "View_SL" :
                      updateElement(function (el, param) {
                            return {
                                    id: el.id,
                                    shadeId: el.shadeId,
                                    hueId: el.hueId,
                                    lightness: Math.max(0.0, el.lightness - 0.01),
                                    saturation: el.saturation
                                  };
                          });
                      break;
                  
                }
                $$event.preventDefault();
                return ;
            case "ArrowRight" :
                switch (view) {
                  case "View_LC" :
                      updateElement(function (el, hue) {
                            var match = Color.convert([
                                  hue,
                                  el.saturation,
                                  el.lightness
                                ], Color.OKHSL, Color.OKLCH);
                            var newL = Math.min(1.0, match[0] + 0.01);
                            var match$1 = Color.convert([
                                  newL,
                                  match[1],
                                  match[2]
                                ], Color.OKLCH, Color.OKHSL);
                            var outputL = match$1[2];
                            var outputS = match$1[1];
                            var rgb = Color.convert([
                                  hue,
                                  outputS,
                                  outputL
                                ], Color.OKHSL, Color.sRGB);
                            if (Color.isRGBInGamut(rgb)) {
                              return {
                                      id: el.id,
                                      shadeId: el.shadeId,
                                      hueId: el.hueId,
                                      lightness: outputL,
                                      saturation: outputS
                                    };
                            } else {
                              return el;
                            }
                          });
                      break;
                  case "View_SV" :
                      updateElement(function (el, hue) {
                            var match = Color.convert([
                                  hue,
                                  el.saturation,
                                  el.lightness
                                ], Color.OKHSL, Color.OKHSV);
                            var newV = Math.min(1.0, match[2] + 0.01);
                            var match$1 = Color.convert([
                                  hue,
                                  match[1],
                                  newV
                                ], Color.OKHSV, Color.OKHSL);
                            return {
                                    id: el.id,
                                    shadeId: el.shadeId,
                                    hueId: el.hueId,
                                    lightness: match$1[2],
                                    saturation: match$1[1]
                                  };
                          });
                      break;
                  case "View_SL" :
                      updateElement(function (el, param) {
                            return {
                                    id: el.id,
                                    shadeId: el.shadeId,
                                    hueId: el.hueId,
                                    lightness: Math.min(1.0, el.lightness + 0.01),
                                    saturation: el.saturation
                                  };
                          });
                      break;
                  
                }
                $$event.preventDefault();
                return ;
            case "ArrowUp" :
                updateElement(function (el, param) {
                      return {
                              id: el.id,
                              shadeId: el.shadeId,
                              hueId: el.hueId,
                              lightness: el.lightness,
                              saturation: Math.min(1.0, el.saturation + 0.01)
                            };
                    });
                $$event.preventDefault();
                return ;
            case "d" :
                return updateHue(function (hue) {
                            var result = hue + 10.0;
                            if (result > 360) {
                              return result - 360;
                            } else {
                              return result;
                            }
                          });
            case "j" :
                return updateHue(function (hue) {
                            var result = hue + 1.0;
                            if (result > 360) {
                              return result - 360;
                            } else {
                              return result;
                            }
                          });
            case "k" :
                return updateHue(function (hue) {
                            var result = hue - 1.0;
                            if (result < 0) {
                              return result + 360;
                            } else {
                              return result;
                            }
                          });
            case "u" :
                return updateHue(function (hue) {
                            var result = hue - 10.0;
                            if (result < 0) {
                              return result + 360;
                            } else {
                              return result;
                            }
                          });
            default:
              return ;
          }
        }), [
        selectedElement,
        view
      ]);
  React.useEffect((function () {
          document.addEventListener("keydown", handleKeydown);
          return (function () {
                    document.removeEventListener("keydown", handleKeydown);
                  });
        }), [
        selectedElement,
        view
      ]);
  var picks = match$1[0].toSorted(function (a, b) {
        return a.value - b.value;
      });
  var hueLen = picks.length;
  var shadeLen = shades.length;
  var makeNewHue = function (copy, left, right) {
    var newValue = (left + right) / 2;
    var hueId = Ulid.ulid();
    return {
            id: hueId,
            value: newValue,
            name: Common.hueToName(newValue),
            elements: copy.elements.map(function (v) {
                  return {
                          id: Ulid.ulid(),
                          shadeId: v.shadeId,
                          hueId: hueId,
                          lightness: v.lightness,
                          saturation: v.saturation
                        };
                })
          };
  };
  var newEndHue = function () {
    setPicks(function (p_) {
          var lastHue = picks.toReversed()[0];
          var $$new = makeNewHue(lastHue, lastHue.value, 360);
          return Belt_Array.concatMany([
                      p_,
                      [$$new]
                    ]);
        });
  };
  var newEndShade = function () {
    var newShadeId = Ulid.ulid();
    setShades(function (s_) {
          return Belt_Array.concatMany([
                      s_,
                      [{
                          id: newShadeId,
                          name: "New"
                        }]
                    ]);
        });
    setPicks(function (p_) {
          return p_.map(function (v) {
                      return {
                              id: v.id,
                              value: v.value,
                              name: v.name,
                              elements: Core__Array.reduceWithIndex(v.elements, [], (function (a, c, i) {
                                      if (i === (v.elements.length - 1 | 0)) {
                                        return Belt_Array.concatMany([
                                                    a,
                                                    [
                                                      c,
                                                      {
                                                        id: Ulid.ulid(),
                                                        shadeId: newShadeId,
                                                        hueId: v.id,
                                                        lightness: Common.Utils.bound(0.0, 1.0, (c.lightness + 1.0) / 2),
                                                        saturation: Common.Utils.bound(0.0, 1.0, (c.saturation + 1.0) / 2)
                                                      }
                                                    ]
                                                  ]);
                                      } else {
                                        return Belt_Array.concatMany([
                                                    a,
                                                    [c]
                                                  ]);
                                      }
                                    }))
                            };
                    });
        });
  };
  return JsxRuntime.jsxs("div", {
              children: [
                JsxRuntime.jsxs("div", {
                      children: [
                        JsxRuntime.jsx("div", {
                              children: JsxRuntime.jsx(make, {}),
                              className: "h-12 w-12"
                            }),
                        "Amici Color"
                      ],
                      className: "font-black text-4xl flex flex-row items-center gap-2 pb-4"
                    }),
                JsxRuntime.jsxs("div", {
                      children: [
                        JsxRuntime.jsxs("div", {
                              children: [
                                JsxRuntime.jsx("div", {
                                      children: [
                                          "View_LC",
                                          "View_SL",
                                          "View_SV"
                                        ].map(function (v) {
                                            var isSelected = view === v;
                                            return JsxRuntime.jsx("button", {
                                                        children: viewName(v),
                                                        className: [
                                                            "px-2 rounded",
                                                            isSelected ? "bg-blue-600 text-white" : "bg-blue-200"
                                                          ].join(" "),
                                                        onClick: (function (param) {
                                                            setView(function (param) {
                                                                  return v;
                                                                });
                                                          })
                                                      });
                                          }),
                                      className: "flex flex-row gap-2"
                                    }),
                                JsxRuntime.jsxs("div", {
                                      children: [
                                        JsxRuntime.jsxs("div", {
                                              children: [
                                                JsxRuntime.jsx(ViewGamut.make, {
                                                      hues: picks,
                                                      selectedHue: selectedHue,
                                                      selectedElement: selectedElement,
                                                      view: view,
                                                      setSelectedElement: setSelectedElement
                                                    }),
                                                JsxRuntime.jsx(YStack.make, {
                                                      hues: picks,
                                                      selectedElement: selectedElement,
                                                      view: view,
                                                      setSelectedElement: setSelectedElement,
                                                      setSelectedHue: setSelectedHue,
                                                      selectedHue: selectedHue
                                                    })
                                              ],
                                              className: "flex flex-row"
                                            }),
                                        JsxRuntime.jsx(XStack.make, {
                                              hues: picks,
                                              selectedElement: selectedElement,
                                              view: view,
                                              setSelectedElement: setSelectedElement,
                                              setSelectedHue: setSelectedHue
                                            })
                                      ],
                                      className: "flex flex-col py-2"
                                    })
                              ]
                            }),
                        JsxRuntime.jsxs("div", {
                              children: [
                                JsxRuntime.jsx("div", {
                                      children: picks.map(function (pick, i) {
                                            var isLastRow = i === (picks.length - 1 | 0);
                                            var onDelete = function () {
                                              setPicks(function (p_) {
                                                    return p_.filter(function (v) {
                                                                return v.id !== pick.id;
                                                              });
                                                  });
                                              setSelectedHue(function (v) {
                                                    return Core__Option.flatMap(v, (function (p) {
                                                                  if (p === pick.id) {
                                                                    return ;
                                                                  } else {
                                                                    return p;
                                                                  }
                                                                }));
                                                  });
                                            };
                                            var onAdd = function () {
                                              setPicks(function (p_) {
                                                    return Core__Array.reduceWithIndex(p_, [], (function (acc, cur, i) {
                                                                  var leftValue = i === 0 ? 0 : p_[i - 1 | 0].value;
                                                                  if (cur.id === pick.id) {
                                                                    return Belt_Array.concatMany([
                                                                                acc,
                                                                                [
                                                                                  makeNewHue(cur, leftValue, cur.value),
                                                                                  cur
                                                                                ]
                                                                              ]);
                                                                  } else {
                                                                    return Belt_Array.concatMany([
                                                                                acc,
                                                                                [cur]
                                                                              ]);
                                                                  }
                                                                }));
                                                  });
                                            };
                                            return JsxRuntime.jsxs("div", {
                                                        children: [
                                                          JsxRuntime.jsxs("div", {
                                                                children: [
                                                                  JsxRuntime.jsx(make$1, {
                                                                        items: [[
                                                                                "Add Row Before",
                                                                                onAdd
                                                                              ]].concat(isLastRow ? [[
                                                                                    "Add Row After",
                                                                                    (function () {
                                                                                        newEndHue();
                                                                                      })
                                                                                  ]] : []).concat([[
                                                                                "Delete Row",
                                                                                onDelete
                                                                              ]])
                                                                      }),
                                                                  JsxRuntime.jsx("input", {
                                                                        className: "w-20 h-5",
                                                                        type: "text",
                                                                        value: pick.name,
                                                                        onChange: (function (e) {
                                                                            var value = e.target.value;
                                                                            setPicks(function (cur) {
                                                                                  return cur.map(function (v) {
                                                                                              if (v.id === pick.id) {
                                                                                                return {
                                                                                                        id: v.id,
                                                                                                        value: v.value,
                                                                                                        name: value,
                                                                                                        elements: v.elements
                                                                                                      };
                                                                                              } else {
                                                                                                return v;
                                                                                              }
                                                                                            });
                                                                                });
                                                                          })
                                                                      })
                                                                ],
                                                                className: "flex-row flex w-full justify-between items-center gap-2 h-full"
                                                              }),
                                                          JsxRuntime.jsx("div", {
                                                                className: "flex flex-row justify-start gap-2 w-full"
                                                              })
                                                        ],
                                                        className: " "
                                                      }, pick.id);
                                          }),
                                      className: "overflow-hidden",
                                      style: {
                                        display: "grid",
                                        gridColumn: "1 / 2",
                                        gridRow: "2 / -1",
                                        gridTemplateColumns: "subgrid",
                                        gridTemplateRows: "subgrid"
                                      }
                                    }),
                                JsxRuntime.jsx("div", {
                                      children: shades.map(function (shade, i) {
                                            var isLastColumn = i === (picks.length - 1 | 0);
                                            var onDelete = function () {
                                              setPicks(function (p_) {
                                                    return p_.map(function (v) {
                                                                return {
                                                                        id: v.id,
                                                                        value: v.value,
                                                                        name: v.name,
                                                                        elements: v.elements.filter(function (e) {
                                                                              return e.shadeId !== shade.id;
                                                                            })
                                                                      };
                                                              });
                                                  });
                                              setShades(function (s_) {
                                                    return s_.filter(function (v) {
                                                                return v.id !== shade.id;
                                                              });
                                                  });
                                            };
                                            var onAdd = function () {
                                              var newShadeId = Ulid.ulid();
                                              setShades(function (s_) {
                                                    return Core__Array.reduce(s_, [], (function (a, c) {
                                                                  if (c.id === shade.id) {
                                                                    return Belt_Array.concatMany([
                                                                                a,
                                                                                [
                                                                                  {
                                                                                    id: newShadeId,
                                                                                    name: "New"
                                                                                  },
                                                                                  c
                                                                                ]
                                                                              ]);
                                                                  } else {
                                                                    return Belt_Array.concatMany([
                                                                                a,
                                                                                [c]
                                                                              ]);
                                                                  }
                                                                }));
                                                  });
                                              setPicks(function (p_) {
                                                    return p_.map(function (hue) {
                                                                return {
                                                                        id: hue.id,
                                                                        value: hue.value,
                                                                        name: hue.name,
                                                                        elements: Core__Array.reduceWithIndex(hue.elements, [], (function (a, c, i) {
                                                                                if (c.shadeId !== shade.id) {
                                                                                  return Belt_Array.concatMany([
                                                                                              a,
                                                                                              [c]
                                                                                            ]);
                                                                                }
                                                                                var match = i === 0 ? [
                                                                                    0.0,
                                                                                    0.0
                                                                                  ] : (function (x) {
                                                                                        return [
                                                                                                x.saturation,
                                                                                                x.lightness
                                                                                              ];
                                                                                      })(hue.elements[i - 1 | 0]);
                                                                                return Belt_Array.concatMany([
                                                                                            a,
                                                                                            [
                                                                                              {
                                                                                                id: Ulid.ulid(),
                                                                                                shadeId: newShadeId,
                                                                                                hueId: hue.id,
                                                                                                lightness: Common.Utils.bound(0.0, 1.0, (match[1] + c.lightness) / 2),
                                                                                                saturation: Common.Utils.bound(0.0, 1.0, (match[0] + c.saturation) / 2)
                                                                                              },
                                                                                              c
                                                                                            ]
                                                                                          ]);
                                                                              }))
                                                                      };
                                                              });
                                                  });
                                            };
                                            return JsxRuntime.jsxs("div", {
                                                        children: [
                                                          JsxRuntime.jsx(make$1, {
                                                                items: [[
                                                                        "Add Column Before",
                                                                        onAdd
                                                                      ]].concat(isLastColumn ? [[
                                                                            "Add Column After",
                                                                            (function () {
                                                                                newEndShade();
                                                                              })
                                                                          ]] : []).concat([[
                                                                        "Delete Column",
                                                                        onDelete
                                                                      ]])
                                                              }),
                                                          JsxRuntime.jsx("input", {
                                                                className: "w-10 h-5",
                                                                type: "text",
                                                                value: shade.name,
                                                                onChange: (function (e) {
                                                                    var value = e.target.value;
                                                                    setShades(function (cur) {
                                                                          return cur.map(function (v) {
                                                                                      if (v.id === shade.id) {
                                                                                        return {
                                                                                                id: v.id,
                                                                                                name: value
                                                                                              };
                                                                                      } else {
                                                                                        return v;
                                                                                      }
                                                                                    });
                                                                        });
                                                                  })
                                                              })
                                                        ],
                                                        className: " flex flex-col gap-2"
                                                      }, shade.id);
                                          }),
                                      className: "overflow-hidden",
                                      style: {
                                        display: "grid",
                                        gridColumn: "2 / -1",
                                        gridRow: "1 / 2",
                                        gridTemplateColumns: "subgrid",
                                        gridTemplateRows: "subgrid"
                                      }
                                    }),
                                JsxRuntime.jsx("div", {
                                      children: Belt_Array.concatMany(picks.map(function (hue) {
                                                return hue.elements.map(function (element) {
                                                            var hex = Color.RGBToHex(Color.convert([
                                                                      hue.value,
                                                                      element.saturation,
                                                                      element.lightness
                                                                    ], Color.OKHSL, Color.sRGB));
                                                            return JsxRuntime.jsx("div", {
                                                                        children: Core__Option.mapOr(selectedElement, false, (function (e) {
                                                                                return e === element.id;
                                                                              })) ? "•" : null,
                                                                        className: "w-12 h-12 max-h-12 max-w-12 flex flex-row items-center justify-center cursor-pointer",
                                                                        style: {
                                                                          backgroundColor: hex
                                                                        },
                                                                        onClick: (function (param) {
                                                                            setSelectedElement(function (param) {
                                                                                  return element.id;
                                                                                });
                                                                            setSelectedHue(function (param) {
                                                                                  return element.hueId;
                                                                                });
                                                                          })
                                                                      }, element.id);
                                                          });
                                              })),
                                      style: {
                                        display: "grid",
                                        gridColumn: "2 / -1",
                                        gridRow: "2 / -1",
                                        gridTemplateColumns: "subgrid",
                                        gridTemplateRows: "subgrid"
                                      }
                                    })
                              ],
                              className: "py-6 w-fit h-fit",
                              style: {
                                display: "grid",
                                gridTemplateColumns: "auto repeat(" + shadeLen.toString() + ", 3rem)",
                                gridTemplateRows: "auto repeat(" + hueLen.toString() + ", 3rem)"
                              }
                            })
                      ],
                      className: "flex flex-row"
                    })
              ]
            });
}

function App(props) {
  return JsxRuntime.jsx("div", {
              children: JsxRuntime.jsx(App$Palette, {}),
              className: "p-6 min-h-screen bg-white"
            });
}

var make$2 = App;

export {
  make$2 as make,
}
/* make Not a pure module */
